#!/usr/bin/env node
"use strict";var ne=Object.create;var M=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var ae=Object.getPrototypeOf,le=Object.prototype.hasOwnProperty;var D=(o,t)=>()=>(o&&(t=o(o=0)),t);var F=(o,t)=>()=>(t||o((t={exports:{}}).exports,t),t.exports),St=(o,t)=>{for(var e in t)M(o,e,{get:t[e],enumerable:!0})},wt=(o,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of oe(t))!le.call(o,s)&&s!==e&&M(o,s,{get:()=>t[s],enumerable:!(i=re(t,s))||i.enumerable});return o};var b=(o,t,e)=>(e=o!=null?ne(ae(o)):{},wt(t||!o||!o.__esModule?M(e,"default",{value:o,enumerable:!0}):e,o)),At=o=>wt(M({},"__esModule",{value:!0}),o);var j=F(Z=>{var L=class extends Error{constructor(t,e,i){super(i),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=e,this.exitCode=t,this.nestedError=void 0}},X=class extends L{constructor(t){super(1,"commander.invalidArgument",t),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}};Z.CommanderError=L;Z.InvalidArgumentError=X});var W=F(et=>{var{InvalidArgumentError:ce}=j(),tt=class{constructor(t,e){switch(this.description=e||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,t[0]){case"<":this.required=!0,this._name=t.slice(1,-1);break;case"[":this.required=!1,this._name=t.slice(1,-1);break;default:this.required=!0,this._name=t;break}this._name.length>3&&this._name.slice(-3)==="..."&&(this.variadic=!0,this._name=this._name.slice(0,-3))}name(){return this._name}_concatValue(t,e){return e===this.defaultValue||!Array.isArray(e)?[t]:e.concat(t)}default(t,e){return this.defaultValue=t,this.defaultValueDescription=e,this}argParser(t){return this.parseArg=t,this}choices(t){return this.argChoices=t.slice(),this.parseArg=(e,i)=>{if(!this.argChoices.includes(e))throw new ce(`Allowed choices are ${this.argChoices.join(", ")}.`);return this.variadic?this._concatValue(e,i):e},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}};function ue(o){let t=o.name()+(o.variadic===!0?"...":"");return o.required?"<"+t+">":"["+t+"]"}et.Argument=tt;et.humanReadableArgName=ue});var st=F(Ot=>{var{humanReadableArgName:he}=W(),it=class{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}visibleCommands(t){let e=t.commands.filter(i=>!i._hidden);if(t._hasImplicitHelpCommand()){let[,i,s]=t._helpCommandnameAndArgs.match(/([^ ]+) *(.*)/),n=t.createCommand(i).helpOption(!1);n.description(t._helpCommandDescription),s&&n.arguments(s),e.push(n)}return this.sortSubcommands&&e.sort((i,s)=>i.name().localeCompare(s.name())),e}compareOptions(t,e){let i=s=>s.short?s.short.replace(/^-/,""):s.long.replace(/^--/,"");return i(t).localeCompare(i(e))}visibleOptions(t){let e=t.options.filter(n=>!n.hidden),i=t._hasHelpOption&&t._helpShortFlag&&!t._findOption(t._helpShortFlag),s=t._hasHelpOption&&!t._findOption(t._helpLongFlag);if(i||s){let n;i?s?n=t.createOption(t._helpFlags,t._helpDescription):n=t.createOption(t._helpShortFlag,t._helpDescription):n=t.createOption(t._helpLongFlag,t._helpDescription),e.push(n)}return this.sortOptions&&e.sort(this.compareOptions),e}visibleGlobalOptions(t){if(!this.showGlobalOptions)return[];let e=[];for(let i=t.parent;i;i=i.parent){let s=i.options.filter(n=>!n.hidden);e.push(...s)}return this.sortOptions&&e.sort(this.compareOptions),e}visibleArguments(t){return t._argsDescription&&t.registeredArguments.forEach(e=>{e.description=e.description||t._argsDescription[e.name()]||""}),t.registeredArguments.find(e=>e.description)?t.registeredArguments:[]}subcommandTerm(t){let e=t.registeredArguments.map(i=>he(i)).join(" ");return t._name+(t._aliases[0]?"|"+t._aliases[0]:"")+(t.options.length?" [options]":"")+(e?" "+e:"")}optionTerm(t){return t.flags}argumentTerm(t){return t.name()}longestSubcommandTermLength(t,e){return e.visibleCommands(t).reduce((i,s)=>Math.max(i,e.subcommandTerm(s).length),0)}longestOptionTermLength(t,e){return e.visibleOptions(t).reduce((i,s)=>Math.max(i,e.optionTerm(s).length),0)}longestGlobalOptionTermLength(t,e){return e.visibleGlobalOptions(t).reduce((i,s)=>Math.max(i,e.optionTerm(s).length),0)}longestArgumentTermLength(t,e){return e.visibleArguments(t).reduce((i,s)=>Math.max(i,e.argumentTerm(s).length),0)}commandUsage(t){let e=t._name;t._aliases[0]&&(e=e+"|"+t._aliases[0]);let i="";for(let s=t.parent;s;s=s.parent)i=s.name()+" "+i;return i+e+" "+t.usage()}commandDescription(t){return t.description()}subcommandDescription(t){return t.summary()||t.description()}optionDescription(t){let e=[];return t.argChoices&&e.push(`choices: ${t.argChoices.map(i=>JSON.stringify(i)).join(", ")}`),t.defaultValue!==void 0&&(t.required||t.optional||t.isBoolean()&&typeof t.defaultValue=="boolean")&&e.push(`default: ${t.defaultValueDescription||JSON.stringify(t.defaultValue)}`),t.presetArg!==void 0&&t.optional&&e.push(`preset: ${JSON.stringify(t.presetArg)}`),t.envVar!==void 0&&e.push(`env: ${t.envVar}`),e.length>0?`${t.description} (${e.join(", ")})`:t.description}argumentDescription(t){let e=[];if(t.argChoices&&e.push(`choices: ${t.argChoices.map(i=>JSON.stringify(i)).join(", ")}`),t.defaultValue!==void 0&&e.push(`default: ${t.defaultValueDescription||JSON.stringify(t.defaultValue)}`),e.length>0){let i=`(${e.join(", ")})`;return t.description?`${t.description} ${i}`:i}return t.description}formatHelp(t,e){let i=e.padWidth(t,e),s=e.helpWidth||80,n=2,r=2;function a(g,y){if(y){let k=`${g.padEnd(i+r)}${y}`;return e.wrap(k,s-n,i+r)}return g}function l(g){return g.join(`
`).replace(/^/gm," ".repeat(n))}let c=[`Usage: ${e.commandUsage(t)}`,""],u=e.commandDescription(t);u.length>0&&(c=c.concat([e.wrap(u,s,0),""]));let f=e.visibleArguments(t).map(g=>a(e.argumentTerm(g),e.argumentDescription(g)));f.length>0&&(c=c.concat(["Arguments:",l(f),""]));let x=e.visibleOptions(t).map(g=>a(e.optionTerm(g),e.optionDescription(g)));if(x.length>0&&(c=c.concat(["Options:",l(x),""])),this.showGlobalOptions){let g=e.visibleGlobalOptions(t).map(y=>a(e.optionTerm(y),e.optionDescription(y)));g.length>0&&(c=c.concat(["Global Options:",l(g),""]))}let C=e.visibleCommands(t).map(g=>a(e.subcommandTerm(g),e.subcommandDescription(g)));return C.length>0&&(c=c.concat(["Commands:",l(C),""])),c.join(`
`)}padWidth(t,e){return Math.max(e.longestOptionTermLength(t,e),e.longestGlobalOptionTermLength(t,e),e.longestSubcommandTermLength(t,e),e.longestArgumentTermLength(t,e))}wrap(t,e,i,s=40){let n=" \\f\\t\\v\xA0\u1680\u2000-\u200A\u202F\u205F\u3000\uFEFF",r=new RegExp(`[\\n][${n}]+`);if(t.match(r))return t;let a=e-i;if(a<s)return t;let l=t.slice(0,i),c=t.slice(i).replace(`\r
`,`
`),u=" ".repeat(i),x="\\s\u200B",C=new RegExp(`
|.{1,${a-1}}([${x}]|$)|[^${x}]+?([${x}]|$)`,"g"),g=c.match(C)||[];return l+g.map((y,k)=>y===`
`?"":(k>0?u:"")+y.trimEnd()).join(`
`)}};Ot.Help=it});var ot=F(B=>{var{InvalidArgumentError:fe}=j(),nt=class{constructor(t,e){this.flags=t,this.description=e||"",this.required=t.includes("<"),this.optional=t.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test(t),this.mandatory=!1;let i=Et(t);this.short=i.shortFlag,this.long=i.longFlag,this.negate=!1,this.long&&(this.negate=this.long.startsWith("--no-")),this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0}default(t,e){return this.defaultValue=t,this.defaultValueDescription=e,this}preset(t){return this.presetArg=t,this}conflicts(t){return this.conflictsWith=this.conflictsWith.concat(t),this}implies(t){let e=t;return typeof t=="string"&&(e={[t]:!0}),this.implied=Object.assign(this.implied||{},e),this}env(t){return this.envVar=t,this}argParser(t){return this.parseArg=t,this}makeOptionMandatory(t=!0){return this.mandatory=!!t,this}hideHelp(t=!0){return this.hidden=!!t,this}_concatValue(t,e){return e===this.defaultValue||!Array.isArray(e)?[t]:e.concat(t)}choices(t){return this.argChoices=t.slice(),this.parseArg=(e,i)=>{if(!this.argChoices.includes(e))throw new fe(`Allowed choices are ${this.argChoices.join(", ")}.`);return this.variadic?this._concatValue(e,i):e},this}name(){return this.long?this.long.replace(/^--/,""):this.short.replace(/^-/,"")}attributeName(){return pe(this.name().replace(/^no-/,""))}is(t){return this.short===t||this.long===t}isBoolean(){return!this.required&&!this.optional&&!this.negate}},rt=class{constructor(t){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,t.forEach(e=>{e.negate?this.negativeOptions.set(e.attributeName(),e):this.positiveOptions.set(e.attributeName(),e)}),this.negativeOptions.forEach((e,i)=>{this.positiveOptions.has(i)&&this.dualOptions.add(i)})}valueFromOption(t,e){let i=e.attributeName();if(!this.dualOptions.has(i))return!0;let s=this.negativeOptions.get(i).presetArg,n=s!==void 0?s:!1;return e.negate===(n===t)}};function pe(o){return o.split("-").reduce((t,e)=>t+e[0].toUpperCase()+e.slice(1))}function Et(o){let t,e,i=o.split(/[ |,]+/);return i.length>1&&!/^[[<]/.test(i[1])&&(t=i.shift()),e=i.shift(),!t&&/^-[^-]$/.test(e)&&(t=e,e=void 0),{shortFlag:t,longFlag:e}}B.Option=nt;B.splitOptionFlags=Et;B.DualOptions=rt});var vt=F(Pt=>{function de(o,t){if(Math.abs(o.length-t.length)>3)return Math.max(o.length,t.length);let e=[];for(let i=0;i<=o.length;i++)e[i]=[i];for(let i=0;i<=t.length;i++)e[0][i]=i;for(let i=1;i<=t.length;i++)for(let s=1;s<=o.length;s++){let n=1;o[s-1]===t[i-1]?n=0:n=1,e[s][i]=Math.min(e[s-1][i]+1,e[s][i-1]+1,e[s-1][i-1]+n),s>1&&i>1&&o[s-1]===t[i-2]&&o[s-2]===t[i-1]&&(e[s][i]=Math.min(e[s][i],e[s-2][i-2]+1))}return e[o.length][t.length]}function me(o,t){if(!t||t.length===0)return"";t=Array.from(new Set(t));let e=o.startsWith("--");e&&(o=o.slice(2),t=t.map(r=>r.slice(2)));let i=[],s=3,n=.4;return t.forEach(r=>{if(r.length<=1)return;let a=de(o,r),l=Math.max(o.length,r.length);(l-a)/l>n&&(a<s?(s=a,i=[r]):a===s&&i.push(r))}),i.sort((r,a)=>r.localeCompare(a)),e&&(i=i.map(r=>`--${r}`)),i.length>1?`
(Did you mean one of ${i.join(", ")}?)`:i.length===1?`
(Did you mean ${i[0]}?)`:""}Pt.suggestSimilar=me});var Nt=F(Vt=>{var ge=require("events").EventEmitter,at=require("child_process"),E=require("path"),lt=require("fs"),p=require("process"),{Argument:xe,humanReadableArgName:_e}=W(),{CommanderError:ct}=j(),{Help:Ce}=st(),{Option:Ft,splitOptionFlags:ye,DualOptions:be}=ot(),{suggestSimilar:Tt}=vt(),ut=class o extends ge{constructor(t){super(),this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!0,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=t||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._outputConfiguration={writeOut:e=>p.stdout.write(e),writeErr:e=>p.stderr.write(e),getOutHelpWidth:()=>p.stdout.isTTY?p.stdout.columns:void 0,getErrHelpWidth:()=>p.stderr.isTTY?p.stderr.columns:void 0,outputError:(e,i)=>i(e)},this._hidden=!1,this._hasHelpOption=!0,this._helpFlags="-h, --help",this._helpDescription="display help for command",this._helpShortFlag="-h",this._helpLongFlag="--help",this._addImplicitHelpCommand=void 0,this._helpCommandName="help",this._helpCommandnameAndArgs="help [command]",this._helpCommandDescription="display help for command",this._helpConfiguration={}}copyInheritedSettings(t){return this._outputConfiguration=t._outputConfiguration,this._hasHelpOption=t._hasHelpOption,this._helpFlags=t._helpFlags,this._helpDescription=t._helpDescription,this._helpShortFlag=t._helpShortFlag,this._helpLongFlag=t._helpLongFlag,this._helpCommandName=t._helpCommandName,this._helpCommandnameAndArgs=t._helpCommandnameAndArgs,this._helpCommandDescription=t._helpCommandDescription,this._helpConfiguration=t._helpConfiguration,this._exitCallback=t._exitCallback,this._storeOptionsAsProperties=t._storeOptionsAsProperties,this._combineFlagAndOptionalValue=t._combineFlagAndOptionalValue,this._allowExcessArguments=t._allowExcessArguments,this._enablePositionalOptions=t._enablePositionalOptions,this._showHelpAfterError=t._showHelpAfterError,this._showSuggestionAfterError=t._showSuggestionAfterError,this}_getCommandAndAncestors(){let t=[];for(let e=this;e;e=e.parent)t.push(e);return t}command(t,e,i){let s=e,n=i;typeof s=="object"&&s!==null&&(n=s,s=null),n=n||{};let[,r,a]=t.match(/([^ ]+) *(.*)/),l=this.createCommand(r);return s&&(l.description(s),l._executableHandler=!0),n.isDefault&&(this._defaultCommandName=l._name),l._hidden=!!(n.noHelp||n.hidden),l._executableFile=n.executableFile||null,a&&l.arguments(a),this.commands.push(l),l.parent=this,l.copyInheritedSettings(this),s?this:l}createCommand(t){return new o(t)}createHelp(){return Object.assign(new Ce,this.configureHelp())}configureHelp(t){return t===void 0?this._helpConfiguration:(this._helpConfiguration=t,this)}configureOutput(t){return t===void 0?this._outputConfiguration:(Object.assign(this._outputConfiguration,t),this)}showHelpAfterError(t=!0){return typeof t!="string"&&(t=!!t),this._showHelpAfterError=t,this}showSuggestionAfterError(t=!0){return this._showSuggestionAfterError=!!t,this}addCommand(t,e){if(!t._name)throw new Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);return e=e||{},e.isDefault&&(this._defaultCommandName=t._name),(e.noHelp||e.hidden)&&(t._hidden=!0),this.commands.push(t),t.parent=this,this}createArgument(t,e){return new xe(t,e)}argument(t,e,i,s){let n=this.createArgument(t,e);return typeof i=="function"?n.default(s).argParser(i):n.default(i),this.addArgument(n),this}arguments(t){return t.trim().split(/ +/).forEach(e=>{this.argument(e)}),this}addArgument(t){let e=this.registeredArguments.slice(-1)[0];if(e&&e.variadic)throw new Error(`only the last argument can be variadic '${e.name()}'`);if(t.required&&t.defaultValue!==void 0&&t.parseArg===void 0)throw new Error(`a default value for a required argument is never used: '${t.name()}'`);return this.registeredArguments.push(t),this}addHelpCommand(t,e){return t===!1?this._addImplicitHelpCommand=!1:(this._addImplicitHelpCommand=!0,typeof t=="string"&&(this._helpCommandName=t.split(" ")[0],this._helpCommandnameAndArgs=t),this._helpCommandDescription=e||this._helpCommandDescription),this}_hasImplicitHelpCommand(){return this._addImplicitHelpCommand===void 0?this.commands.length&&!this._actionHandler&&!this._findCommand("help"):this._addImplicitHelpCommand}hook(t,e){let i=["preSubcommand","preAction","postAction"];if(!i.includes(t))throw new Error(`Unexpected value for event passed to hook : '${t}'.
Expecting one of '${i.join("', '")}'`);return this._lifeCycleHooks[t]?this._lifeCycleHooks[t].push(e):this._lifeCycleHooks[t]=[e],this}exitOverride(t){return t?this._exitCallback=t:this._exitCallback=e=>{if(e.code!=="commander.executeSubCommandAsync")throw e},this}_exit(t,e,i){this._exitCallback&&this._exitCallback(new ct(t,e,i)),p.exit(t)}action(t){let e=i=>{let s=this.registeredArguments.length,n=i.slice(0,s);return this._storeOptionsAsProperties?n[s]=this:n[s]=this.opts(),n.push(this),t.apply(this,n)};return this._actionHandler=e,this}createOption(t,e){return new Ft(t,e)}_callParseArg(t,e,i,s){try{return t.parseArg(e,i)}catch(n){if(n.code==="commander.invalidArgument"){let r=`${s} ${n.message}`;this.error(r,{exitCode:n.exitCode,code:n.code})}throw n}}addOption(t){let e=t.name(),i=t.attributeName();if(t.negate){let n=t.long.replace(/^--no-/,"--");this._findOption(n)||this.setOptionValueWithSource(i,t.defaultValue===void 0?!0:t.defaultValue,"default")}else t.defaultValue!==void 0&&this.setOptionValueWithSource(i,t.defaultValue,"default");this.options.push(t);let s=(n,r,a)=>{n==null&&t.presetArg!==void 0&&(n=t.presetArg);let l=this.getOptionValue(i);n!==null&&t.parseArg?n=this._callParseArg(t,n,l,r):n!==null&&t.variadic&&(n=t._concatValue(n,l)),n==null&&(t.negate?n=!1:t.isBoolean()||t.optional?n=!0:n=""),this.setOptionValueWithSource(i,n,a)};return this.on("option:"+e,n=>{let r=`error: option '${t.flags}' argument '${n}' is invalid.`;s(n,r,"cli")}),t.envVar&&this.on("optionEnv:"+e,n=>{let r=`error: option '${t.flags}' value '${n}' from env '${t.envVar}' is invalid.`;s(n,r,"env")}),this}_optionEx(t,e,i,s,n){if(typeof e=="object"&&e instanceof Ft)throw new Error("To add an Option object use addOption() instead of option() or requiredOption()");let r=this.createOption(e,i);if(r.makeOptionMandatory(!!t.mandatory),typeof s=="function")r.default(n).argParser(s);else if(s instanceof RegExp){let a=s;s=(l,c)=>{let u=a.exec(l);return u?u[0]:c},r.default(n).argParser(s)}else r.default(s);return this.addOption(r)}option(t,e,i,s){return this._optionEx({},t,e,i,s)}requiredOption(t,e,i,s){return this._optionEx({mandatory:!0},t,e,i,s)}combineFlagAndOptionalValue(t=!0){return this._combineFlagAndOptionalValue=!!t,this}allowUnknownOption(t=!0){return this._allowUnknownOption=!!t,this}allowExcessArguments(t=!0){return this._allowExcessArguments=!!t,this}enablePositionalOptions(t=!0){return this._enablePositionalOptions=!!t,this}passThroughOptions(t=!0){if(this._passThroughOptions=!!t,this.parent&&t&&!this.parent._enablePositionalOptions)throw new Error("passThroughOptions can not be used without turning on enablePositionalOptions for parent command(s)");return this}storeOptionsAsProperties(t=!0){if(this.options.length)throw new Error("call .storeOptionsAsProperties() before adding options");return this._storeOptionsAsProperties=!!t,this}getOptionValue(t){return this._storeOptionsAsProperties?this[t]:this._optionValues[t]}setOptionValue(t,e){return this.setOptionValueWithSource(t,e,void 0)}setOptionValueWithSource(t,e,i){return this._storeOptionsAsProperties?this[t]=e:this._optionValues[t]=e,this._optionValueSources[t]=i,this}getOptionValueSource(t){return this._optionValueSources[t]}getOptionValueSourceWithGlobals(t){let e;return this._getCommandAndAncestors().forEach(i=>{i.getOptionValueSource(t)!==void 0&&(e=i.getOptionValueSource(t))}),e}_prepareUserArgs(t,e){if(t!==void 0&&!Array.isArray(t))throw new Error("first parameter to parse must be array or undefined");e=e||{},t===void 0&&(t=p.argv,p.versions&&p.versions.electron&&(e.from="electron")),this.rawArgs=t.slice();let i;switch(e.from){case void 0:case"node":this._scriptPath=t[1],i=t.slice(2);break;case"electron":p.defaultApp?(this._scriptPath=t[1],i=t.slice(2)):i=t.slice(1);break;case"user":i=t.slice(0);break;default:throw new Error(`unexpected parse option { from: '${e.from}' }`)}return!this._name&&this._scriptPath&&this.nameFromFilename(this._scriptPath),this._name=this._name||"program",i}parse(t,e){let i=this._prepareUserArgs(t,e);return this._parseCommand([],i),this}async parseAsync(t,e){let i=this._prepareUserArgs(t,e);return await this._parseCommand([],i),this}_executeSubCommand(t,e){e=e.slice();let i=!1,s=[".js",".ts",".tsx",".mjs",".cjs"];function n(u,f){let x=E.resolve(u,f);if(lt.existsSync(x))return x;if(s.includes(E.extname(f)))return;let C=s.find(g=>lt.existsSync(`${x}${g}`));if(C)return`${x}${C}`}this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let r=t._executableFile||`${this._name}-${t._name}`,a=this._executableDir||"";if(this._scriptPath){let u;try{u=lt.realpathSync(this._scriptPath)}catch{u=this._scriptPath}a=E.resolve(E.dirname(u),a)}if(a){let u=n(a,r);if(!u&&!t._executableFile&&this._scriptPath){let f=E.basename(this._scriptPath,E.extname(this._scriptPath));f!==this._name&&(u=n(a,`${f}-${t._name}`))}r=u||r}i=s.includes(E.extname(r));let l;p.platform!=="win32"?i?(e.unshift(r),e=Ht(p.execArgv).concat(e),l=at.spawn(p.argv[0],e,{stdio:"inherit"})):l=at.spawn(r,e,{stdio:"inherit"}):(e.unshift(r),e=Ht(p.execArgv).concat(e),l=at.spawn(p.execPath,e,{stdio:"inherit"})),l.killed||["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach(f=>{p.on(f,()=>{l.killed===!1&&l.exitCode===null&&l.kill(f)})});let c=this._exitCallback;c?l.on("close",()=>{c(new ct(p.exitCode||0,"commander.executeSubCommandAsync","(close)"))}):l.on("close",p.exit.bind(p)),l.on("error",u=>{if(u.code==="ENOENT"){let f=a?`searched for local subcommand relative to directory '${a}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",x=`'${r}' does not exist
 - if '${t._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${f}`;throw new Error(x)}else if(u.code==="EACCES")throw new Error(`'${r}' not executable`);if(!c)p.exit(1);else{let f=new ct(1,"commander.executeSubCommandAsync","(error)");f.nestedError=u,c(f)}}),this.runningCommand=l}_dispatchSubcommand(t,e,i){let s=this._findCommand(t);s||this.help({error:!0});let n;return n=this._chainOrCallSubCommandHook(n,s,"preSubcommand"),n=this._chainOrCall(n,()=>{if(s._executableHandler)this._executeSubCommand(s,e.concat(i));else return s._parseCommand(e,i)}),n}_dispatchHelpCommand(t){t||this.help();let e=this._findCommand(t);return e&&!e._executableHandler&&e.help(),this._dispatchSubcommand(t,[],[this._helpLongFlag||this._helpShortFlag])}_checkNumberOfArguments(){this.registeredArguments.forEach((t,e)=>{t.required&&this.args[e]==null&&this.missingArgument(t.name())}),!(this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)&&this.args.length>this.registeredArguments.length&&this._excessArguments(this.args)}_processArguments(){let t=(i,s,n)=>{let r=s;if(s!==null&&i.parseArg){let a=`error: command-argument value '${s}' is invalid for argument '${i.name()}'.`;r=this._callParseArg(i,s,n,a)}return r};this._checkNumberOfArguments();let e=[];this.registeredArguments.forEach((i,s)=>{let n=i.defaultValue;i.variadic?s<this.args.length?(n=this.args.slice(s),i.parseArg&&(n=n.reduce((r,a)=>t(i,a,r),i.defaultValue))):n===void 0&&(n=[]):s<this.args.length&&(n=this.args[s],i.parseArg&&(n=t(i,n,i.defaultValue))),e[s]=n}),this.processedArgs=e}_chainOrCall(t,e){return t&&t.then&&typeof t.then=="function"?t.then(()=>e()):e()}_chainOrCallHooks(t,e){let i=t,s=[];return this._getCommandAndAncestors().reverse().filter(n=>n._lifeCycleHooks[e]!==void 0).forEach(n=>{n._lifeCycleHooks[e].forEach(r=>{s.push({hookedCommand:n,callback:r})})}),e==="postAction"&&s.reverse(),s.forEach(n=>{i=this._chainOrCall(i,()=>n.callback(n.hookedCommand,this))}),i}_chainOrCallSubCommandHook(t,e,i){let s=t;return this._lifeCycleHooks[i]!==void 0&&this._lifeCycleHooks[i].forEach(n=>{s=this._chainOrCall(s,()=>n(this,e))}),s}_parseCommand(t,e){let i=this.parseOptions(e);if(this._parseOptionsEnv(),this._parseOptionsImplied(),t=t.concat(i.operands),e=i.unknown,this.args=t.concat(e),t&&this._findCommand(t[0]))return this._dispatchSubcommand(t[0],t.slice(1),e);if(this._hasImplicitHelpCommand()&&t[0]===this._helpCommandName)return this._dispatchHelpCommand(t[1]);if(this._defaultCommandName)return $t(this,e),this._dispatchSubcommand(this._defaultCommandName,t,e);this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName&&this.help({error:!0}),$t(this,i.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let s=()=>{i.unknown.length>0&&this.unknownOption(i.unknown[0])},n=`command:${this.name()}`;if(this._actionHandler){s(),this._processArguments();let r;return r=this._chainOrCallHooks(r,"preAction"),r=this._chainOrCall(r,()=>this._actionHandler(this.processedArgs)),this.parent&&(r=this._chainOrCall(r,()=>{this.parent.emit(n,t,e)})),r=this._chainOrCallHooks(r,"postAction"),r}if(this.parent&&this.parent.listenerCount(n))s(),this._processArguments(),this.parent.emit(n,t,e);else if(t.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",t,e);this.listenerCount("command:*")?this.emit("command:*",t,e):this.commands.length?this.unknownCommand():(s(),this._processArguments())}else this.commands.length?(s(),this.help({error:!0})):(s(),this._processArguments())}_findCommand(t){if(t)return this.commands.find(e=>e._name===t||e._aliases.includes(t))}_findOption(t){return this.options.find(e=>e.is(t))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach(t=>{t.options.forEach(e=>{e.mandatory&&t.getOptionValue(e.attributeName())===void 0&&t.missingMandatoryOptionValue(e)})})}_checkForConflictingLocalOptions(){let t=this.options.filter(i=>{let s=i.attributeName();return this.getOptionValue(s)===void 0?!1:this.getOptionValueSource(s)!=="default"});t.filter(i=>i.conflictsWith.length>0).forEach(i=>{let s=t.find(n=>i.conflictsWith.includes(n.attributeName()));s&&this._conflictingOption(i,s)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach(t=>{t._checkForConflictingLocalOptions()})}parseOptions(t){let e=[],i=[],s=e,n=t.slice();function r(l){return l.length>1&&l[0]==="-"}let a=null;for(;n.length;){let l=n.shift();if(l==="--"){s===i&&s.push(l),s.push(...n);break}if(a&&!r(l)){this.emit(`option:${a.name()}`,l);continue}if(a=null,r(l)){let c=this._findOption(l);if(c){if(c.required){let u=n.shift();u===void 0&&this.optionMissingArgument(c),this.emit(`option:${c.name()}`,u)}else if(c.optional){let u=null;n.length>0&&!r(n[0])&&(u=n.shift()),this.emit(`option:${c.name()}`,u)}else this.emit(`option:${c.name()}`);a=c.variadic?c:null;continue}}if(l.length>2&&l[0]==="-"&&l[1]!=="-"){let c=this._findOption(`-${l[1]}`);if(c){c.required||c.optional&&this._combineFlagAndOptionalValue?this.emit(`option:${c.name()}`,l.slice(2)):(this.emit(`option:${c.name()}`),n.unshift(`-${l.slice(2)}`));continue}}if(/^--[^=]+=/.test(l)){let c=l.indexOf("="),u=this._findOption(l.slice(0,c));if(u&&(u.required||u.optional)){this.emit(`option:${u.name()}`,l.slice(c+1));continue}}if(r(l)&&(s=i),(this._enablePositionalOptions||this._passThroughOptions)&&e.length===0&&i.length===0){if(this._findCommand(l)){e.push(l),n.length>0&&i.push(...n);break}else if(l===this._helpCommandName&&this._hasImplicitHelpCommand()){e.push(l),n.length>0&&e.push(...n);break}else if(this._defaultCommandName){i.push(l),n.length>0&&i.push(...n);break}}if(this._passThroughOptions){s.push(l),n.length>0&&s.push(...n);break}s.push(l)}return{operands:e,unknown:i}}opts(){if(this._storeOptionsAsProperties){let t={},e=this.options.length;for(let i=0;i<e;i++){let s=this.options[i].attributeName();t[s]=s===this._versionOptionName?this._version:this[s]}return t}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce((t,e)=>Object.assign(t,e.opts()),{})}error(t,e){this._outputConfiguration.outputError(`${t}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError=="string"?this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`):this._showHelpAfterError&&(this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0}));let i=e||{},s=i.exitCode||1,n=i.code||"commander.error";this._exit(s,n,t)}_parseOptionsEnv(){this.options.forEach(t=>{if(t.envVar&&t.envVar in p.env){let e=t.attributeName();(this.getOptionValue(e)===void 0||["default","config","env"].includes(this.getOptionValueSource(e)))&&(t.required||t.optional?this.emit(`optionEnv:${t.name()}`,p.env[t.envVar]):this.emit(`optionEnv:${t.name()}`))}})}_parseOptionsImplied(){let t=new be(this.options),e=i=>this.getOptionValue(i)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(i));this.options.filter(i=>i.implied!==void 0&&e(i.attributeName())&&t.valueFromOption(this.getOptionValue(i.attributeName()),i)).forEach(i=>{Object.keys(i.implied).filter(s=>!e(s)).forEach(s=>{this.setOptionValueWithSource(s,i.implied[s],"implied")})})}missingArgument(t){let e=`error: missing required argument '${t}'`;this.error(e,{code:"commander.missingArgument"})}optionMissingArgument(t){let e=`error: option '${t.flags}' argument missing`;this.error(e,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue(t){let e=`error: required option '${t.flags}' not specified`;this.error(e,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption(t,e){let i=r=>{let a=r.attributeName(),l=this.getOptionValue(a),c=this.options.find(f=>f.negate&&a===f.attributeName()),u=this.options.find(f=>!f.negate&&a===f.attributeName());return c&&(c.presetArg===void 0&&l===!1||c.presetArg!==void 0&&l===c.presetArg)?c:u||r},s=r=>{let a=i(r),l=a.attributeName();return this.getOptionValueSource(l)==="env"?`environment variable '${a.envVar}'`:`option '${a.flags}'`},n=`error: ${s(t)} cannot be used with ${s(e)}`;this.error(n,{code:"commander.conflictingOption"})}unknownOption(t){if(this._allowUnknownOption)return;let e="";if(t.startsWith("--")&&this._showSuggestionAfterError){let s=[],n=this;do{let r=n.createHelp().visibleOptions(n).filter(a=>a.long).map(a=>a.long);s=s.concat(r),n=n.parent}while(n&&!n._enablePositionalOptions);e=Tt(t,s)}let i=`error: unknown option '${t}'${e}`;this.error(i,{code:"commander.unknownOption"})}_excessArguments(t){if(this._allowExcessArguments)return;let e=this.registeredArguments.length,i=e===1?"":"s",n=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${e} argument${i} but got ${t.length}.`;this.error(n,{code:"commander.excessArguments"})}unknownCommand(){let t=this.args[0],e="";if(this._showSuggestionAfterError){let s=[];this.createHelp().visibleCommands(this).forEach(n=>{s.push(n.name()),n.alias()&&s.push(n.alias())}),e=Tt(t,s)}let i=`error: unknown command '${t}'${e}`;this.error(i,{code:"commander.unknownCommand"})}version(t,e,i){if(t===void 0)return this._version;this._version=t,e=e||"-V, --version",i=i||"output the version number";let s=this.createOption(e,i);return this._versionOptionName=s.attributeName(),this.options.push(s),this.on("option:"+s.name(),()=>{this._outputConfiguration.writeOut(`${t}
`),this._exit(0,"commander.version",t)}),this}description(t,e){return t===void 0&&e===void 0?this._description:(this._description=t,e&&(this._argsDescription=e),this)}summary(t){return t===void 0?this._summary:(this._summary=t,this)}alias(t){if(t===void 0)return this._aliases[0];let e=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler&&(e=this.commands[this.commands.length-1]),t===e._name)throw new Error("Command alias can't be the same as its name");return e._aliases.push(t),this}aliases(t){return t===void 0?this._aliases:(t.forEach(e=>this.alias(e)),this)}usage(t){if(t===void 0){if(this._usage)return this._usage;let e=this.registeredArguments.map(i=>_e(i));return[].concat(this.options.length||this._hasHelpOption?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?e:[]).join(" ")}return this._usage=t,this}name(t){return t===void 0?this._name:(this._name=t,this)}nameFromFilename(t){return this._name=E.basename(t,E.extname(t)),this}executableDir(t){return t===void 0?this._executableDir:(this._executableDir=t,this)}helpInformation(t){let e=this.createHelp();return e.helpWidth===void 0&&(e.helpWidth=t&&t.error?this._outputConfiguration.getErrHelpWidth():this._outputConfiguration.getOutHelpWidth()),e.formatHelp(this,e)}_getHelpContext(t){t=t||{};let e={error:!!t.error},i;return e.error?i=s=>this._outputConfiguration.writeErr(s):i=s=>this._outputConfiguration.writeOut(s),e.write=t.write||i,e.command=this,e}outputHelp(t){let e;typeof t=="function"&&(e=t,t=void 0);let i=this._getHelpContext(t);this._getCommandAndAncestors().reverse().forEach(n=>n.emit("beforeAllHelp",i)),this.emit("beforeHelp",i);let s=this.helpInformation(i);if(e&&(s=e(s),typeof s!="string"&&!Buffer.isBuffer(s)))throw new Error("outputHelp callback must return a string or a Buffer");i.write(s),this._helpLongFlag&&this.emit(this._helpLongFlag),this.emit("afterHelp",i),this._getCommandAndAncestors().forEach(n=>n.emit("afterAllHelp",i))}helpOption(t,e){if(typeof t=="boolean")return this._hasHelpOption=t,this;this._helpFlags=t||this._helpFlags,this._helpDescription=e||this._helpDescription;let i=ye(this._helpFlags);return this._helpShortFlag=i.shortFlag,this._helpLongFlag=i.longFlag,this}help(t){this.outputHelp(t);let e=p.exitCode||0;e===0&&t&&typeof t!="function"&&t.error&&(e=1),this._exit(e,"commander.help","(outputHelp)")}addHelpText(t,e){let i=["beforeAll","before","after","afterAll"];if(!i.includes(t))throw new Error(`Unexpected value for position to addHelpText.
Expecting one of '${i.join("', '")}'`);let s=`${t}Help`;return this.on(s,n=>{let r;typeof e=="function"?r=e({error:n.error,command:n.command}):r=e,r&&n.write(`${r}
`)}),this}};function $t(o,t){o._hasHelpOption&&t.find(i=>i===o._helpLongFlag||i===o._helpShortFlag)&&(o.outputHelp(),o._exit(0,"commander.helpDisplayed","(outputHelp)"))}function Ht(o){return o.map(t=>{if(!t.startsWith("--inspect"))return t;let e,i="127.0.0.1",s="9229",n;return(n=t.match(/^(--inspect(-brk)?)$/))!==null?e=n[1]:(n=t.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null?(e=n[1],/^\d+$/.test(n[3])?s=n[3]:i=n[3]):(n=t.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null&&(e=n[1],i=n[3],s=n[4]),e&&s!=="0"?`${e}=${i}:${parseInt(s)+1}`:t})}Vt.Command=ut});var Rt=F((A,It)=>{var{Argument:Se}=W(),{Command:kt}=Nt(),{CommanderError:we,InvalidArgumentError:jt}=j(),{Help:Ae}=st(),{Option:Oe}=ot();A=It.exports=new kt;A.program=A;A.Command=kt;A.Option=Oe;A.Argument=Se;A.Help=Ae;A.CommanderError=we;A.InvalidArgumentError=jt;A.InvalidOptionArgumentError=jt});function Ee(){let o=new Map;for(let[t,e]of Object.entries(d)){for(let[i,s]of Object.entries(e))d[i]={open:`\x1B[${s[0]}m`,close:`\x1B[${s[1]}m`},e[i]=d[i],o.set(s[0],s[1]);Object.defineProperty(d,t,{value:e,enumerable:!1})}return Object.defineProperty(d,"codes",{value:o,enumerable:!1}),d.color.close="\x1B[39m",d.bgColor.close="\x1B[49m",d.color.ansi=Dt(),d.color.ansi256=Lt(),d.color.ansi16m=Wt(),d.bgColor.ansi=Dt(10),d.bgColor.ansi256=Lt(10),d.bgColor.ansi16m=Wt(10),Object.defineProperties(d,{rgbToAnsi256:{value(t,e,i){return t===e&&e===i?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(e/255*5)+Math.round(i/255*5)},enumerable:!1},hexToRgb:{value(t){let e=/[a-f\d]{6}|[a-f\d]{3}/i.exec(t.toString(16));if(!e)return[0,0,0];let[i]=e;i.length===3&&(i=[...i].map(n=>n+n).join(""));let s=Number.parseInt(i,16);return[s>>16&255,s>>8&255,s&255]},enumerable:!1},hexToAnsi256:{value:t=>d.rgbToAnsi256(...d.hexToRgb(t)),enumerable:!1},ansi256ToAnsi:{value(t){if(t<8)return 30+t;if(t<16)return 90+(t-8);let e,i,s;if(t>=232)e=((t-232)*10+8)/255,i=e,s=e;else{t-=16;let a=t%36;e=Math.floor(t/36)/5,i=Math.floor(a/6)/5,s=a%6/5}let n=Math.max(e,i,s)*2;if(n===0)return 30;let r=30+(Math.round(s)<<2|Math.round(i)<<1|Math.round(e));return n===2&&(r+=60),r},enumerable:!1},rgbToAnsi:{value:(t,e,i)=>d.ansi256ToAnsi(d.rgbToAnsi256(t,e,i)),enumerable:!1},hexToAnsi:{value:t=>d.ansi256ToAnsi(d.hexToAnsi256(t)),enumerable:!1}}),d}var Dt,Lt,Wt,d,ft,q,G,pt,Pe,O,dt=D(()=>{Dt=(o=0)=>t=>`\x1B[${t+o}m`,Lt=(o=0)=>t=>`\x1B[${38+o};5;${t}m`,Wt=(o=0)=>(t,e,i)=>`\x1B[${38+o};2;${t};${e};${i}m`,d={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}},ft=Object.keys(d.modifier),q=Object.keys(d.color),G=Object.keys(d.bgColor),pt=[...q,...G];Pe=Ee(),O=Pe});function w(o,t=globalThis.Deno?globalThis.Deno.args:K.default.argv){let e=o.startsWith("-")?"":o.length===1?"-":"--",i=t.indexOf(e+o),s=t.indexOf("--");return i!==-1&&(s===-1||i<s)}function ve(){if("FORCE_COLOR"in m)return m.FORCE_COLOR==="true"?1:m.FORCE_COLOR==="false"?0:m.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(m.FORCE_COLOR,10),3)}function Fe(o){return o===0?!1:{level:o,hasBasic:!0,has256:o>=2,has16m:o>=3}}function Te(o,{streamIsTTY:t,sniffFlags:e=!0}={}){let i=ve();i!==void 0&&(J=i);let s=e?J:i;if(s===0)return 0;if(e){if(w("color=16m")||w("color=full")||w("color=truecolor"))return 3;if(w("color=256"))return 2}if("TF_BUILD"in m&&"AGENT_NAME"in m)return 1;if(o&&!t&&s===void 0)return 0;let n=s||0;if(m.TERM==="dumb")return n;if(K.default.platform==="win32"){let r=zt.default.release().split(".");return Number(r[0])>=10&&Number(r[2])>=10586?Number(r[2])>=14931?3:2:1}if("CI"in m)return["GITHUB_ACTIONS","GITEA_ACTIONS","CIRCLECI"].some(r=>r in m)?3:["TRAVIS","APPVEYOR","GITLAB_CI","BUILDKITE","DRONE"].some(r=>r in m)||m.CI_NAME==="codeship"?1:n;if("TEAMCITY_VERSION"in m)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(m.TEAMCITY_VERSION)?1:0;if(m.COLORTERM==="truecolor"||m.TERM==="xterm-kitty"||m.TERM==="xterm-ghostty"||m.TERM==="wezterm")return 3;if("TERM_PROGRAM"in m){let r=Number.parseInt((m.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(m.TERM_PROGRAM){case"iTerm.app":return r>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(m.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(m.TERM)||"COLORTERM"in m?1:n}function Bt(o,t={}){let e=Te(o,{streamIsTTY:o&&o.isTTY,...t});return Fe(e)}var K,zt,mt,m,J,$e,Ut,qt=D(()=>{K=b(require("node:process"),1),zt=b(require("node:os"),1),mt=b(require("node:tty"),1);({env:m}=K.default);w("no-color")||w("no-colors")||w("color=false")||w("color=never")?J=0:(w("color")||w("colors")||w("color=true")||w("color=always"))&&(J=1);$e={stdout:Bt({isTTY:mt.default.isatty(1)}),stderr:Bt({isTTY:mt.default.isatty(2)})},Ut=$e});function Gt(o,t,e){let i=o.indexOf(t);if(i===-1)return o;let s=t.length,n=0,r="";do r+=o.slice(n,i)+t+e,n=i+s,i=o.indexOf(t,n);while(i!==-1);return r+=o.slice(n),r}function Jt(o,t,e,i){let s=0,n="";do{let r=o[i-1]==="\r";n+=o.slice(s,r?i-1:i)+t+(r?`\r
`:`
`)+e,s=i+1,i=o.indexOf(`
`,s)}while(i!==-1);return n+=o.slice(s),n}var Kt=D(()=>{});var Xt={};St(Xt,{Chalk:()=>Ct,backgroundColorNames:()=>G,backgroundColors:()=>G,chalkStderr:()=>Ie,colorNames:()=>pt,colors:()=>pt,default:()=>Re,foregroundColorNames:()=>q,foregroundColors:()=>q,modifierNames:()=>ft,modifiers:()=>ft,supportsColor:()=>gt,supportsColorStderr:()=>xt});function R(o){return Qt(o)}var gt,xt,_t,V,I,Yt,N,He,Ct,Qt,yt,Ve,Ne,bt,Y,ke,je,Ie,Re,Zt=D(()=>{dt();qt();Kt();dt();({stdout:gt,stderr:xt}=Ut),_t=Symbol("GENERATOR"),V=Symbol("STYLER"),I=Symbol("IS_EMPTY"),Yt=["ansi","ansi","ansi256","ansi16m"],N=Object.create(null),He=(o,t={})=>{if(t.level&&!(Number.isInteger(t.level)&&t.level>=0&&t.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");let e=gt?gt.level:0;o.level=t.level===void 0?e:t.level},Ct=class{constructor(t){return Qt(t)}},Qt=o=>{let t=(...e)=>e.join(" ");return He(t,o),Object.setPrototypeOf(t,R.prototype),t};Object.setPrototypeOf(R.prototype,Function.prototype);for(let[o,t]of Object.entries(O))N[o]={get(){let e=Y(this,bt(t.open,t.close,this[V]),this[I]);return Object.defineProperty(this,o,{value:e}),e}};N.visible={get(){let o=Y(this,this[V],!0);return Object.defineProperty(this,"visible",{value:o}),o}};yt=(o,t,e,...i)=>o==="rgb"?t==="ansi16m"?O[e].ansi16m(...i):t==="ansi256"?O[e].ansi256(O.rgbToAnsi256(...i)):O[e].ansi(O.rgbToAnsi(...i)):o==="hex"?yt("rgb",t,e,...O.hexToRgb(...i)):O[e][o](...i),Ve=["rgb","hex","ansi256"];for(let o of Ve){N[o]={get(){let{level:e}=this;return function(...i){let s=bt(yt(o,Yt[e],"color",...i),O.color.close,this[V]);return Y(this,s,this[I])}}};let t="bg"+o[0].toUpperCase()+o.slice(1);N[t]={get(){let{level:e}=this;return function(...i){let s=bt(yt(o,Yt[e],"bgColor",...i),O.bgColor.close,this[V]);return Y(this,s,this[I])}}}}Ne=Object.defineProperties(()=>{},{...N,level:{enumerable:!0,get(){return this[_t].level},set(o){this[_t].level=o}}}),bt=(o,t,e)=>{let i,s;return e===void 0?(i=o,s=t):(i=e.openAll+o,s=t+e.closeAll),{open:o,close:t,openAll:i,closeAll:s,parent:e}},Y=(o,t,e)=>{let i=(...s)=>ke(i,s.length===1?""+s[0]:s.join(" "));return Object.setPrototypeOf(i,Ne),i[_t]=o,i[V]=t,i[I]=e,i},ke=(o,t)=>{if(o.level<=0||!t)return o[I]?"":t;let e=o[V];if(e===void 0)return t;let{openAll:i,closeAll:s}=e;if(t.includes("\x1B"))for(;e!==void 0;)t=Gt(t,e.close,e.open),e=e.parent;let n=t.indexOf(`
`);return n!==-1&&(t=Jt(t,s,i,n)),i+t+s};Object.defineProperties(R.prototype,N);je=R(),Ie=R({level:xt?xt.level:0}),Re=je});var Me={};St(Me,{listHandlersCommand:()=>ee,statisticsCommand:()=>se,validateCommand:()=>te,validateFileCommand:()=>ie});module.exports=At(Me);var v=b(require("node:path"));var Mt=b(Rt(),1),{program:P,createCommand:Ge,createArgument:Je,createOption:Ke,CommanderError:Ye,InvalidArgumentError:Qe,InvalidOptionArgumentError:Xe,Command:Ze,Argument:ti,Option:ei,Help:ii}=Mt.default;var T=class{constructor(t){this.ts=t}analyzeHandlerContexts(t,e){let i=this.ts.createSourceFile(e,t,this.ts.ScriptTarget.Latest,!0),s=[],n=r=>{if(this.isSSTFunctionCall(r)){let a=this.extractFunctionContext(r,i);a&&s.push(a)}if(this.isSSTCronCall(r)){let a=this.extractCronContext(r,i);a&&s.push(a)}if(this.isQueueSubscribeCall(r)){let a=this.extractQueueContext(r,i);a&&s.push(a)}if(this.isBucketNotifyCall(r)){let a=this.extractBucketContext(r,i);s.push(...a)}if(this.isApiGatewayV1RouteCall(r)){let a=this.extractApiGatewayV1Context(r,i);a&&s.push(a)}this.ts.forEachChild(r,n)};return n(i),s}isWithinHandlerString(t,e){for(let i of e){let s=i.node.getStart(),n=i.node.getEnd();if(t>=s&&t<=n)return i}return null}isSSTFunctionCall(t){if(!this.ts.isNewExpression(t))return!1;let e=t.expression;return this.ts.isPropertyAccessExpression(e)?this.isPropertyChain(e,["sst","aws","Function"]):!1}isSSTCronCall(t){if(!this.ts.isNewExpression(t))return!1;let e=t.expression;return this.ts.isPropertyAccessExpression(e)?this.isPropertyChain(e,["sst","aws","Cron"]):!1}isQueueSubscribeCall(t){if(!this.ts.isCallExpression(t))return!1;let e=t.expression;return this.ts.isPropertyAccessExpression(e)?this.ts.isIdentifier(e.name)&&e.name.text==="subscribe":!1}isApiGatewayV1RouteCall(t){if(!this.ts.isCallExpression(t))return!1;let e=t.expression;return this.ts.isPropertyAccessExpression(e)?this.ts.isIdentifier(e.name)&&e.name.text==="route":!1}isPropertyChain(t,e){let i=[],s=t;for(;this.ts.isPropertyAccessExpression(s);)i.unshift(s.name.text),s=s.expression;return this.ts.isIdentifier(s)&&i.unshift(s.text),i.length===e.length&&i.every((n,r)=>n===e[r])}extractFunctionContext(t,e){let i=t.arguments;if(!i||i.length<2)return null;let s=i[1];if(!this.ts.isObjectLiteralExpression(s))return null;let n=s.properties.find(a=>this.ts.isPropertyAssignment(a)&&this.ts.isIdentifier(a.name)&&a.name.text==="handler");if(!n)return null;let r=null;return(this.ts.isStringLiteral(n.initializer)||this.ts.isTemplateExpression(n.initializer)||this.ts.isNoSubstitutionTemplateLiteral(n.initializer))&&(r=this.extractStringValue(n.initializer,e)),{type:"function",position:n.getStart(),expectedPath:r,node:n}}extractCronContext(t,e){let i=t.arguments;if(!i||i.length<2)return null;let s=i[1];if(!this.ts.isObjectLiteralExpression(s))return null;let n=s.properties.find(a=>this.ts.isPropertyAssignment(a)&&this.ts.isIdentifier(a.name)&&a.name.text==="function");if(!n)return null;let r=null;return(this.ts.isStringLiteral(n.initializer)||this.ts.isTemplateExpression(n.initializer)||this.ts.isNoSubstitutionTemplateLiteral(n.initializer))&&(r=this.extractStringValue(n.initializer,e)),{type:"cron",position:n.getStart(),expectedPath:r,node:n}}extractQueueContext(t,e){let i=t.arguments;if(!i||i.length<1)return null;let s=i[0],n=null;return(this.ts.isStringLiteral(s)||this.ts.isTemplateExpression(s)||this.ts.isNoSubstitutionTemplateLiteral(s))&&(n=this.extractStringValue(s,e)),{type:"queue",position:s.getStart(),expectedPath:n,node:s}}extractApiGatewayV1Context(t,e){let i=t.arguments;if(!i||i.length<2)return null;let s=i[1],n=null;return(this.ts.isStringLiteral(s)||this.ts.isTemplateExpression(s)||this.ts.isNoSubstitutionTemplateLiteral(s))&&(n=this.extractStringValue(s,e)),{type:"apigatewayv1",position:s.getStart(),expectedPath:n,node:s}}extractStringValue(t,e){if(this.ts.isStringLiteral(t))return t.text;if(this.ts.isTemplateExpression(t)){let i=t.head.text;for(let s of t.templateSpans){let n=this.resolveExpression(s.expression,e);i+=n||"",i+=s.literal.text}return i}return this.ts.isNoSubstitutionTemplateLiteral(t)?t.text:null}resolveExpression(t,e){return e?this.ts.isIdentifier(t)?this.resolveVariableValue(t.text,e):this.ts.isPropertyAccessExpression(t)?null:this.ts.isStringLiteral(t)?t.text:null:null}resolveVariableValue(t,e){let i=null,s=n=>{if(this.ts.isVariableDeclaration(n)&&this.ts.isIdentifier(n.name)&&n.name.text===t&&n.initializer&&this.ts.isStringLiteral(n.initializer)){i=n.initializer.text;return}if(this.ts.isVariableStatement(n)){for(let r of n.declarationList.declarations)if(this.ts.isIdentifier(r.name)&&r.name.text===t&&r.initializer&&this.ts.isStringLiteral(r.initializer)){i=r.initializer.text;return}}this.ts.forEachChild(n,s)};return s(e),i}isBucketNotifyCall(t){if(!this.ts.isCallExpression(t))return!1;let e=t.expression;return this.ts.isPropertyAccessExpression(e)?this.ts.isIdentifier(e.name)&&e.name.text==="notify":!1}extractBucketContext(t,e){let i=t.arguments;if(i.length===0)return[];let s=i[0],n=[];if(this.ts.isStringLiteral(s)||this.ts.isTemplateExpression(s)||this.ts.isNoSubstitutionTemplateLiteral(s)){let r=this.extractStringValue(s,e);return[{type:"bucket",position:s.getStart(),expectedPath:r,node:s}]}if(this.ts.isObjectLiteralExpression(s)){let r=s.properties.find(a=>this.ts.isPropertyAssignment(a)&&this.ts.isIdentifier(a.name)&&a.name.text==="notifications");if(r&&this.ts.isArrayLiteralExpression(r.initializer)){for(let a of r.initializer.elements)if(this.ts.isObjectLiteralExpression(a)){let l=a.properties.find(c=>this.ts.isPropertyAssignment(c)&&this.ts.isIdentifier(c.name)&&c.name.text==="function");if(l){let c=null;(this.ts.isStringLiteral(l.initializer)||this.ts.isTemplateExpression(l.initializer)||this.ts.isNoSubstitutionTemplateLiteral(l.initializer))&&(c=this.extractStringValue(l.initializer,e)),n.push({type:"bucket",position:l.getStart(),expectedPath:c,node:l})}}}}return n}};var S=b(require("node:fs")),_=b(require("node:path")),$=class{constructor(t="",e){this.workspaceRoot=t;this.ts=e;this.tsConfig=null}async findProjectConfig(){let t=await this.findworkspaceRoot();if(!t)return null;await this.loadTSConfig();let e=_.join(t,"sst.config.ts"),i=_.join(t,"tsconfig.json");return{rootPath:t,sstConfigPath:S.existsSync(e)?e:void 0,tsConfigPath:S.existsSync(i)?i:void 0,includePatterns:this.tsConfig?.include||["**/*.ts"],excludePatterns:this.tsConfig?.exclude||["node_modules/**","dist/**","**/*.test.ts"]}}async findworkspaceRoot(){let t=async e=>{let i=_.join(e,"sst.config.ts");if(S.existsSync(i))return e;let s=await S.promises.readdir(e,{withFileTypes:!0});for(let n of s)if(n.isDirectory()&&!n.name.startsWith(".")&&n.name!=="node_modules"){let r=_.join(e,n.name),a=await t(r);if(a)return a}return null};if(this.workspaceRoot=await t(this.workspaceRoot)||"",!this.workspaceRoot){let e=this.workspaceRoot;for(;e!==_.dirname(e);){e=_.dirname(e);let i=_.join(e,"sst.config.ts");if(S.existsSync(i)){this.workspaceRoot=e;break}}}return this.workspaceRoot&&await this.loadTSConfig(),this.workspaceRoot}async loadTSConfig(){if(!this.workspaceRoot)return;let t=async e=>{try{let i=_.join(e,"tsconfig.json");if(S.existsSync(i))return i;let s=await S.promises.readdir(e,{withFileTypes:!0});for(let n of s)if(n.isDirectory()&&!n.name.startsWith(".")&&n.name!=="node_modules"){let r=_.join(e,n.name),a=await t(r);if(a)return a}}catch(i){console.error(`Error searching for tsconfig.json in ${e}:`,i)}return null};try{let e=await t(this.workspaceRoot);if(e){let i=await S.promises.readFile(e,"utf-8");this.tsConfig=JSON.parse(i)}}catch(e){console.error("Error loading tsconfig.json:",e),this.tsConfig=null}this.tsConfig||console.log("No tsconfig.json found")}async scanHandlers(){let t=await this.findworkspaceRoot();if(!t)return[];let e=[];return await this.scanDirectory(t,e),e}async scanDirectory(t,e){try{let i=await S.promises.readdir(t,{withFileTypes:!0});for(let s of i){let n=_.join(t,s.name);if(s.isDirectory())!s.name.startsWith(".")&&s.name!=="node_modules"&&await this.scanDirectory(n,e);else if(s.isFile()&&s.name.endsWith(".ts")){if(s.name.endsWith(".d.ts"))continue;if(this.shouldIncludeFile(n)){let r=this.getRelativePath(n),a=await this.parseExportedFunctions(n);a.length>0&&e.push({filePath:n,relativePath:r,exportedFunctions:a})}}}}catch{}}shouldIncludeFile(t){if(!this.workspaceRoot)return!1;let e=_.relative(this.workspaceRoot,t).replace(/\\/g,"/");if(e.endsWith(".d.ts")||!e.endsWith(".ts"))return!1;if(this.tsConfig?.exclude){for(let i of this.tsConfig.exclude)if(this.matchesPattern(e,i))return!1}if(this.tsConfig?.include){for(let i of this.tsConfig.include)if(this.matchesPattern(e,i))return!0;return!1}return!0}matchesPattern(t,e){let s=e.replace(/\\/g,"/").split("/"),n=t.split("/");return this.matchParts(n,s,0,0)}matchParts(t,e,i,s){if(s===e.length)return i===t.length;if(i===t.length){for(let r=s;r<e.length;r++)if(e[r]!=="**")return!1;return!0}let n=e[s];return n==="**"?this.matchParts(t,e,i,s+1)?!0:this.matchParts(t,e,i+1,s):this.matchSinglePart(t[i],n)?this.matchParts(t,e,i+1,s+1):!1}matchSinglePart(t,e){return e==="*"?!0:e.includes("*")?new RegExp(e.replace(/\*/g,".*")).test(t):t===e}getRelativePath(t){return this.workspaceRoot?_.relative(this.workspaceRoot,t).replace(/\.ts$/,"").replace(/\\/g,"/"):t}async parseExportedFunctions(t){try{let e=await S.promises.readFile(t,"utf-8"),i=this.ts.createSourceFile(t,e,this.ts.ScriptTarget.Latest,!0),s=[],n=r=>{if(this.ts.isExportAssignment(r)&&this.ts.isIdentifier(r.expression)&&s.push("default"),this.ts.isVariableStatement(r)&&r.modifiers?.some(l=>l.kind===this.ts.SyntaxKind.ExportKeyword)&&r.declarationList.declarations.forEach(l=>{this.ts.isIdentifier(l.name)&&l.initializer&&this.isFunction(l.initializer)&&s.push(l.name.text)}),this.ts.isFunctionDeclaration(r)){let a=r.modifiers?.some(c=>c.kind===this.ts.SyntaxKind.ExportKeyword),l=r.modifiers?.some(c=>c.kind===this.ts.SyntaxKind.DefaultKeyword);a&&(l?s.push("default"):r.name&&s.push(r.name.text))}this.ts.forEachChild(r,n)};return n(i),[...new Set(s)]}catch(e){return console.error(`Error parsing TypeScript file ${t}:`,e),[]}}isFunction(t){return this.ts.isArrowFunction(t)||this.ts.isFunctionExpression(t)||this.ts.isMethodDeclaration(t)||this.ts.isGetAccessorDeclaration(t)||this.ts.isSetAccessorDeclaration(t)?!0:this.ts.isCallExpression(t)?this.isValidFunctionCall(t):this.ts.isAwaitExpression(t)&&this.ts.isCallExpression(t.expression)?this.isValidFunctionCall(t.expression):(this.ts.isNewExpression(t)||this.ts.isConditionalExpression(t),!1)}isValidFunctionCall(t){if(this.ts.isIdentifier(t.expression)){let e=t.expression.text;if(["handle","middleware","withMiddleware","createHandler","wrap","createAWSHandler"].includes(e))return!0}if(this.ts.isPropertyAccessExpression(t.expression)){let e=t.expression.name.text;if(["handle","handler","create","build","configure"].includes(e))return!0}if(this.ts.isPropertyAccessExpression(t.expression)){let e=t.expression.getText();if(e.includes("sst.aws.")||e.includes(".get("))return!1}return!1}};var z=class{constructor(t,e){this.ts=e;this.astAnalyzer=new T(this.ts),this.fileScanner=new $(t,this.ts)}async analyzeUsageStatistics(){try{let t=await this.fileScanner.findProjectConfig();if(!t)return null;let e=await this.fileScanner.scanHandlers(),i=await this.findAllTypeScriptFiles(t),s=new Map,n=new Set;for(let u of e)for(let f of u.exportedFunctions){let x=`${u.relativePath.replace(/\.ts$/,"")}.${f}`;n.add(x),s.set(x,{handlerPath:x,usageCount:0,locations:[]})}for(let u of i)try{let f=await this.readFile(u),x=this.astAnalyzer.analyzeHandlerContexts(f,u);for(let C of x)if(C.expectedPath){let g=this.enhanceContextWithLocation(C,f,u),y=s.get(C.expectedPath);if(y){y.usageCount++;let k=this.getLocationInfo(f,g,u);y.locations.push(k)}else s.set(C.expectedPath,{handlerPath:C.expectedPath,usageCount:1,locations:[this.getLocationInfo(f,g,u)]})}}catch(f){console.warn(`Failed to analyze file ${u}:`,f)}let r=Array.from(s.values()),a=r.filter(u=>u.usageCount>0).sort((u,f)=>f.usageCount-u.usageCount).slice(0,10),l=Array.from(n).filter(u=>s.get(u)?.usageCount===0),c=r.reduce((u,f)=>u+f.usageCount,0);return{totalHandlers:n.size,totalUsages:c,handlerUsages:r,mostUsedHandlers:a,unusedHandlers:l}}catch(t){return console.error("Error analyzing usage statistics:",t),null}}getHandlerUsage(t){return this.analyzeUsageStatistics().then(e=>e&&e.handlerUsages.find(i=>i.handlerPath===t)||null)}enhanceContextWithLocation(t,e,i){let n=this.ts.createSourceFile(i,e,this.ts.ScriptTarget.Latest,!0).getLineAndCharacterOfPosition(t.position);return{...t,line:n.line+1,column:n.character+1,contextInfo:this.getContextDescription(t,e)}}getLocationInfo(t,e,i){return{filePath:i.replace(/^.*\//,""),line:e.line||1,column:e.column||1,contextType:e.type,contextInfo:e.contextInfo||this.getContextDescription(e,t)}}getContextDescription(t,e){switch(t.type){case"function":return this.extractFunctionName(t,e)||"Lambda Function";case"cron":return this.extractCronName(t,e)||"Cron Job";case"queue":return"Queue Subscriber";case"bucket":return"Bucket Notification";case"apigatewayv1":return this.extractRouteInfo(t,e)||"API Gateway V1 Route";default:return"Handler"}}extractFunctionName(t,e){let i=e.split(`
`),s=(t.line||1)-1,n=i[s]||"";for(let r=Math.max(0,s-2);r<=Math.min(i.length-1,s+2);r++){let l=i[r].match(/new\s+sst\.aws\.Function\s*\(\s*["']([^"']+)["']/);if(l)return`Function: ${l[1]}`}return null}extractCronName(t,e){let i=e.split(`
`),s=(t.line||1)-1;for(let n=Math.max(0,s-2);n<=Math.min(i.length-1,s+2);n++){let a=i[n].match(/new\s+sst\.aws\.Cron\s*\(\s*["']([^"']+)["']/);if(a)return`Cron: ${a[1]}`}return null}extractRouteInfo(t,e){let i=e.split(`
`),s=(t.line||1)-1;for(let n=Math.max(0,s-1);n<=Math.min(i.length-1,s+1);n++){let a=i[n].match(/\.route\s*\(\s*["']([^"']+)["']/);if(a)return`Route: ${a[1]}`}return null}async findAllTypeScriptFiles(t){let e=await import("node:fs"),i=await import("node:path"),s=new Set,n=async r=>{try{let a=await e.promises.readdir(r,{withFileTypes:!0});for(let l of a){let c=i.join(r,l.name);l.isDirectory()?!l.name.startsWith(".")&&l.name!=="node_modules"&&l.name!=="dist"&&l.name!=="build"&&await n(c):l.isFile()&&l.name.endsWith(".ts")&&!l.name.endsWith(".d.ts")&&s.add(c)}}catch{}};return await n(t.rootPath),Array.from(s)}async readFile(t){return(await import("node:fs")).promises.readFile(t,"utf-8")}};var ht=b(require("node:fs")),U=b(require("node:path"));var H=class{constructor(t,e){this.ts=e;this.astAnalyzer=new T(this.ts),this.fileScanner=new $(t,this.ts)}async validateProject(){let t=[],e=[];try{let i=await this.fileScanner.findProjectConfig();if(!i)return t.push({type:"file-not-found",message:"No SST project found. Make sure sst.config.ts exists in your project.",filePath:"",handlerPath:""}),{isValid:!1,errors:t,warnings:e,handlers:[],sstProjectConfigPath:"",tsConfigPath:""};let s=await this.fileScanner.scanHandlers(),n=await this.findAllTypeScriptFiles(i);for(let r of n){let a=await this.validateFile(r,s);t.push(...a)}return{isValid:t.length===0,errors:t,warnings:e,handlers:s,sstProjectConfigPath:i.sstConfigPath||"",tsConfigPath:i.tsConfigPath||""}}catch(i){return t.push({type:"file-not-found",message:`Validation failed: ${i}`,filePath:"",handlerPath:""}),{isValid:!1,errors:t,warnings:e,handlers:[],sstProjectConfigPath:"",tsConfigPath:""}}}async validateFile(t,e){let i=[];try{let s=await ht.promises.readFile(t,"utf-8"),n=this.astAnalyzer.analyzeHandlerContexts(s,t);if(n.length===0)return i;let r=new Set(e.map(a=>a.relativePath));for(let a of n)if(a.expectedPath){let l=await this.validateHandlerPath(t,a,r,e);l&&i.push(l)}}catch(s){i.push({type:"file-not-found",message:`Error reading file: ${s}`,filePath:t,handlerPath:""})}return i}async validateHandlerPath(t,e,i,s){let n=e.expectedPath,r=n.lastIndexOf(".");if(r===-1)return{type:"invalid-format",message:`Invalid handler format: "${n}". Expected format: "path/to/file.functionName"`,filePath:t,handlerPath:n};let a=n.substring(0,r),l=n.substring(r+1);if(!i.has(a)){let u=this.findSimilarPaths(a,Array.from(i));return{type:"file-not-found",message:`Handler file not found: "${a}.ts". Make sure the file exists in your project.`,filePath:t,handlerPath:n,suggestions:u.slice(0,3)}}let c=s.find(u=>u.relativePath===a);return c&&!c.exportedFunctions.includes(l)?{type:"function-not-found",message:`Function "${l}" not found in "${a}.ts". Available functions: ${c.exportedFunctions.join(", ")}`,filePath:t,handlerPath:n,suggestions:c.exportedFunctions.slice(0,5)}:null}findSimilarPaths(t,e){let i=t.toLowerCase();return e.map(s=>({path:s,similarity:this.calculateSimilarity(i,s.toLowerCase())})).filter(s=>s.similarity>.4).sort((s,n)=>n.similarity-s.similarity).map(s=>s.path)}calculateSimilarity(t,e){if(t===e)return 1;if(t.length===0||e.length===0)return 0;if(t.includes(e)||e.includes(t))return Math.max(e.length/t.length,t.length/e.length)*.8;let i=new Set(t.split("")),s=new Set(e.split("")),n=[...i].filter(a=>s.has(a)).length,r=Math.max(i.size,s.size);return n/r}async findAllTypeScriptFiles(t){let e=[],i=async s=>{try{let n=await ht.promises.readdir(s,{withFileTypes:!0});for(let r of n){let a=U.join(s,r.name);if(r.isDirectory())!r.name.startsWith(".")&&r.name!=="node_modules"&&await i(a);else if(r.isFile()&&r.name.endsWith(".ts")){let l=U.relative(t.rootPath,a).replace(/\\/g,"/"),c=!0;for(let u of t.excludePatterns)if(this.matchesGlob(l,u)){c=!1;break}c&&t.includePatterns.length>0&&(c=t.includePatterns.some(u=>this.matchesGlob(l,u))),c&&e.push(a)}}}catch(n){console.error(`Error scanning directory ${s}:`,n)}};return await i(t.rootPath),e}matchesGlob(t,e){let i=e.replace(/\./g,"\\.").replace(/\*\*/g,".*").replace(/\*/g,"[^/]*");return new RegExp(`^${i}$`).test(t)}};var h=(Zt(),At(Xt)).default,Q=()=>require.resolve("typescript",{paths:[process.cwd()]});async function te(o){let t=o||{},e=v.default.resolve(t.path||process.cwd());console.log();try{let s=await new H(e,await import(Q())).validateProject();if(t.json){console.log(JSON.stringify(s,null,2));return}if(s.isValid){console.log(h.green("\u2705 All handler references are valid!")),console.log(h.blue(`\u{1F4C1} Found ${s.handlers.length} handler file(s):`));for(let n of s.handlers)console.log(h.green(`\u{1F4C4} ${n.relativePath}.ts`)),console.log(h.gray(`   Functions: ${n.exportedFunctions.join(", ")}`))}else{console.log(h.red(`\u274C Found ${s.errors.length} error(s):`)),console.log();let n=new Map;for(let r of s.errors)n.has(r.filePath)||n.set(r.filePath,[]),n.get(r.filePath).push(r);for(let[r,a]of n){r&&console.log(h.yellow(`\u{1F4C4} ${v.default.relative(e,r)}:`));for(let l of a)console.log(h.red(`  \u274C ${l.message}`)),l.suggestions&&l.suggestions.length>0&&console.log(h.gray(`     \u{1F4A1} Suggestions: ${l.suggestions.join(", ")}`));console.log()}}if(s.warnings.length>0){console.log(h.yellow(`\u26A0\uFE0F  Found ${s.warnings.length} warning(s):`));for(let n of s.warnings)console.log(h.yellow(`  \u26A0\uFE0F  ${n.message}`));console.log()}o||process.exit(s.isValid?0:1)}catch(i){console.error(h.red("\u274C Validation failed:"),i),o||process.exit(1)}}async function ee(o){let t=o||{},e=v.default.resolve(t.path||process.cwd());try{let n=await new H(e,await import(Q())).fileScanner.scanHandlers();if(t.json){console.log(JSON.stringify(n,null,2));return}console.log(h.blue(`\u{1F4C1} Found ${n.length} handler file(s):`)),console.log();for(let r of n)console.log(h.green(`\u{1F4C4} ${r.relativePath}.ts`)),console.log(h.gray(`   Functions: ${r.exportedFunctions.join(", ")}`))}catch(i){console.error(h.red("\u274C Scan failed:"),i),o||process.exit(1)}}async function ie(o,t){let e=t||{},i=v.default.resolve(e.project||process.cwd()),s=v.default.resolve(o);try{let n=new H(i,await import(Q())),a=await n.fileScanner.scanHandlers(),l=await n.validateFile(s,a);if(e.json){console.log(JSON.stringify({errors:l},null,2));return}if(l.length===0)console.log(h.green(`\u2705 ${v.default.relative(i,s)} is valid!`));else{console.log(h.red(`\u274C Found ${l.length} error(s) in ${v.default.relative(i,s)}:`));for(let c of l)console.log(h.red(`  \u274C ${c.message}`)),c.suggestions&&c.suggestions.length>0&&console.log(h.gray(`     \u{1F4A1} Suggestions: ${c.suggestions.join(", ")}`))}!t&&l.length>0&&process.exit(1)}catch(n){throw console.error(h.red("\u274C File validation failed:"),n),t||process.exit(1),n}}async function se(o){let t=o||{},e=v.default.resolve(t.path||process.cwd());try{let i=new z(e,await import(Q()));if(t.handler){let s=await i.getHandlerUsage(t.handler);if(!s){console.log(h.yellow(`\u{1F4CA} Handler "${t.handler}" not found or never used`)),o||process.exit(1);return}if(t.json){console.log(JSON.stringify(s,null,2));return}if(console.log(h.blue(`\u{1F4CA} Statistics for handler: ${h.bold(s.handlerPath)}`)),console.log(),console.log(h.green(`\u{1F522} Usage count: ${s.usageCount}`)),console.log(),s.locations.length>0){console.log(h.cyan("\u{1F4CD} Used in:"));for(let n of s.locations)console.log(h.gray(`  \u{1F4C4} ${n.filePath}:${n.line}:${n.column}`)+h.white(` - ${n.contextInfo}`))}}else{console.log(h.blue(`\u{1F4CA} Analyzing handler usage statistics for: ${e}`)),console.log();let s=await i.analyzeUsageStatistics();if(!s){console.log(h.red("\u274C Failed to analyze project. Make sure sst.config.ts exists.")),o||process.exit(1);return}if(t.json){console.log(JSON.stringify(s,null,2));return}if(console.log(h.green("\u{1F4CB} Summary:")),console.log(`  \u{1F3AF} Total handlers: ${s.totalHandlers}`),console.log(`  \u{1F504} Total usages: ${s.totalUsages}`),console.log(`  \u{1F4C8} Average usage per handler: ${(s.totalUsages/Math.max(s.totalHandlers,1)).toFixed(1)}`),console.log(),s.mostUsedHandlers.length>0){console.log(h.cyan("\u{1F525} Most used handlers:"));for(let n of s.mostUsedHandlers.slice(0,5))console.log(h.white(`  ${n.handlerPath}`)+h.green(` (${n.usageCount} ${n.usageCount===1?"usage":"usages"})`));console.log()}if(s.unusedHandlers.length>0){console.log(h.yellow("\u26A0\uFE0F  Unused handlers:"));for(let n of s.unusedHandlers.slice(0,10))console.log(h.gray(`  \u{1F4C4} ${n}`));s.unusedHandlers.length>10&&console.log(h.gray(`  ... and ${s.unusedHandlers.length-10} more`)),console.log()}console.log(h.blue("\u{1F4A1} Tip: Use --handler <path> to see detailed usage for a specific handler"))}o||process.exit(0)}catch(i){console.error(h.red("\u274C Statistics analysis failed:"),i),o||process.exit(1)}}P.name("sst-validate").description("Validate SST project handler references").version("0.1.0");P.command("validate").description("Validate SST handler references in the current project").option("-p, --path <path>","Path to SST project",process.cwd()).option("--json","Output results in JSON format").option("--fix","Auto-fix common issues (coming soon)").action(te);P.command("scan").description("Scan and list all handler files in the project").option("-p, --path <path>","Path to SST project",process.cwd()).option("--json","Output results in JSON format").action(ee);P.command("check-file").description("Validate a specific TypeScript file").argument("<file>","Path to TypeScript file to validate").option("-p, --project <path>","Path to SST project",process.cwd()).option("--json","Output results in JSON format").action(ie);P.command("stats").alias("statistics").description("Show handler usage statistics").option("-p, --path <path>","Path to SST project",process.cwd()).option("-h, --handler <handler>","Show statistics for a specific handler").option("--json","Output results in JSON format").action(se);P.action(()=>{P.help()});P.parse();0&&(module.exports={listHandlersCommand,statisticsCommand,validateCommand,validateFileCommand});
